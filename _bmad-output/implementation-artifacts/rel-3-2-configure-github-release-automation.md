# Story: Configure GitHub Release Automation

**Story ID:** rel-3-2
**Epic:** Release Epic 3 - Automated Publishing & Distribution
**Sprint:** Release Infrastructure Sprint 3
**Status:** done

---

## Story

As a maintainer,
I want each npm publication to have a corresponding GitHub release,
So that I have a historical record of releases and changelogs within the repository.

---

## Acceptance Criteria

1. **Given** a successful `pnpm changeset publish` run in CI
   **When** the `changesets/action` completes the publication
   **Then** it must create a new GitHub release for each published package version

2. **Given** the GitHub release creation
   **When** examining the release content
   **Then** the release notes must be populated from the Changesets-generated changelog entries

---

## Tasks/Subtasks

- [x] Task 1: Enable explicit GitHub release creation in publish.yml
  - [x] Add `createGithubReleases: true` to changesets/action step's `with` block
  - [x] Add YAML comment explaining GitHub release creation behavior
- [x] Task 2: Write tests validating GitHub release configuration
  - [x] Write test validating changesets/action has createGithubReleases: true
  - [x] Write test validating changelog-github plugin is configured (enables PR-linked release notes)
  - [x] Write test validating contents: write permission exists (required for creating releases)
- [x] Task 3: Run full test suite and verify no regressions
  - [x] Run all package tests and root tests
  - [x] Verify zero regressions (538 passing, 31 pre-existing cli.test.ts failures unrelated)

---

## Dev Notes

### Architecture Requirements
- Per Architecture: GitHub releases created using GitHub's API via changesets — no custom release scripting (NFR10)
- Per Architecture: @changesets/changelog-github generates PR-linked changelog entries for GitHub releases
- Per Architecture: `contents: write` permission required for creating GitHub releases (already present)
- Per Architecture: changesets/action@v1 handles both PR creation and release creation
- Per Architecture: Pin action versions to major (`changesets/action@v1`)

### Technical Approach
- The `changesets/action@v1` has a `createGithubReleases` input that defaults to `true`, but making it explicit ensures:
  1. Intent is clear — future maintainers know release creation is deliberate
  2. If the default ever changes, our workflow isn't silently affected
- The `@changesets/changelog-github` plugin (already configured in `.changeset/config.json`) generates release notes with PR links
- The `contents: write` permission (already in publish.yml) allows the action to create releases via GitHub API
- The `GITHUB_TOKEN` (already passed as env) authenticates the release creation

### Previous Learnings (from Story rel-3-1)
- publish.yml already has correct permissions block: contents: write, pull-requests: write, id-token: write
- changesets/action@v1 already configured with `publish: pnpm changeset publish`
- GITHUB_TOKEN already passed to the action
- @changesets/changelog-github already configured in .changeset/config.json
- All 33 existing publish-workflow tests pass

### What changesets/action Does for Releases
When `createGithubReleases` is `true` (default, we make explicit):
1. After `pnpm changeset publish` succeeds, the action reads the publish output
2. For each published package, it creates a GitHub release tagged with the package version
3. Release notes are populated from the CHANGELOG.md entries generated by `changeset version`
4. @changesets/changelog-github adds PR links to the changelog entries, which appear in the release notes

---

## Dev Agent Record

### Session Log
- **2026-02-07**: Story created and implementation started

### Implementation Plan
1. Add `createGithubReleases: true` to changesets/action step in publish.yml
2. Add explanatory YAML comment
3. Write tests validating the configuration
4. Run full test suite

### Debug Log
- **WorkflowYaml type update**: The `with` property in the step interface was typed as `Record<string, string>`, but `createGithubReleases: true` is parsed as boolean by the YAML parser. Updated type to `Record<string, string | boolean>` to match actual parsed values.

### Completion Notes
- Both acceptance criteria are satisfied:
  - AC 1: `createGithubReleases: true` explicitly configured on changesets/action@v1 — the action creates a GitHub release for each published package version after successful `pnpm changeset publish`
  - AC 2: `@changesets/changelog-github` plugin (configured in `.changeset/config.json` with repo `ZookAnalytics/bmad-orchestrator`) generates PR-linked changelog entries that populate release notes
- 4 new tests added to `publish-workflow.test.ts` (total now 37) validating:
  - `createGithubReleases: true` is set on changesets/action
  - `@changesets/changelog-github` plugin is configured with correct repo
  - GitHub release documentation is present in workflow comments
  - (Note: `contents: write` permission already tested in permissions describe block — duplicate removed during review)
- All 538 tests pass (excludes 31 pre-existing cli.test.ts failures from chalk module issue)

---

## File List

| File | Action | Description |
|------|--------|-------------|
| `.github/workflows/publish.yml` | Modified | Added explicit createGithubReleases: true to changesets/action step |
| `src/release/publish-workflow.test.ts` | Modified | Added tests for GitHub release configuration |
| `_bmad-output/implementation-artifacts/rel-3-2-configure-github-release-automation.md` | Created | Story file |
| `_bmad-output/implementation-artifacts/sprint-status.yaml` | Modified | Story status: backlog → in-progress → review |

---

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-02-07 | Story created and implementation started | Dev Agent |
| 2026-02-07 | All tasks completed, status set to review | Dev Agent |
| 2026-02-07 | Code review: 3 MEDIUM, 1 LOW fixed. M1/M2: test counts corrected (532→538). M3: duplicate contents:write test removed. L1: JSDoc story ref added. Status → done | Code Review |
