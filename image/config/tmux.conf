# tmux configuration for Claude DevContainer
# Optimized for terminal sharing and VSCode integration

# ============================================================================
# Terminal and Color Settings
# ============================================================================

# Set default terminal to support 256 colors
set-option -g default-terminal "tmux-256color"

# Enable truecolor (24-bit) support for various terminal types
# The :Tc flag enables truecolor, :RGB is the modern equivalent
set-option -ga terminal-overrides ",xterm-256color:Tc"
set-option -ga terminal-overrides ",xterm*:Tc"
set-option -ga terminal-overrides ",*256col*:Tc"
set-option -ga terminal-overrides ",alacritty:Tc"
set-option -ga terminal-overrides ",kitty*:Tc"
set-option -ga terminal-overrides ",foot*:Tc"
set-option -ga terminal-overrides ",tmux-256color:Tc"

# Modern tmux 3.2+ terminal-features for RGB color support
set-option -as terminal-features ",xterm-256color:RGB"
set-option -as terminal-features ",xterm:RGB"
set-option -as terminal-features ",*256col*:RGB"
set-option -as terminal-features ",alacritty:RGB"
set-option -as terminal-features ",kitty*:RGB"
set-option -as terminal-features ",tmux-256color:RGB"

# NOTE: TERM and COLORTERM are set via Dockerfile ENV (image/Dockerfile),
# covering all entry paths (docker exec, SSH, VS Code, tmux-session.sh).
# Avoid set-environment for TERM here â€” it can kill running sessions on reload.

# ============================================================================
# Input and Interaction
# ============================================================================

# Mouse mode ON - enables tmux pane scrolling and selection with mouse/trackpad
# For scrollback in apps like Claude Code: use Ctrl-b [ for copy mode, q to exit
set-option -g mouse on

# Allow passthrough for Shellfish iOS clipboard and URL integration
# Also needed for some terminal features like OSC sequences
set-option -g allow-passthrough on

# Reduce escape-time for faster key response (important for vim/neovim)
set-option -sg escape-time 10

# Enable focus events for terminals that support them
set-option -g focus-events on

# Set to 15 for live purpose updates (NFR23: within 30 seconds of change).
set-option -g status-interval 15
set-option -g status-left-length 30
set-option -g status-right-length 120
set-option -g status-left "[#{session_name}] "
# Display instance name and purpose via tmux-purpose script.
# Falls back gracefully if state.json is missing or jq is unavailable.
set-option -g status-right "#(bash /home/node/.local/bin/tmux-purpose)"

# Disable automatic window renaming so names stay clean
set-option -g automatic-rename off
set-option -g allow-rename off

# When a pane/window closes, don't kill the session
# This prevents closing one terminal from affecting others
set-option -g detach-on-destroy on

# Keep windows numbered from 1 (more intuitive)
set-option -g base-index 1
set-option -g pane-base-index 1

# Renumber windows when one is closed
set-option -g renumber-windows on

# Increase history limit
set-option -g history-limit 100000
